<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Anychart libraries for the spiderweb diagram --> 
    <script src="https://cdn.anychart.com/releases/8.11.1/js/anychart-core.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.11.1/js/anychart-radar.min.js"></script>

    <!-- Stylesheet for Anychart --> 
    <link rel="stylesheet" href="https://cdn.anychart.com/releases/8.11.1/css/anychart-ui.min.css" />

    <!-- My own stylesheet --> 
    <link rel="stylesheet" type="text/css" href="sat.css">
</head>

<body>

<div id="quizContainer">

  <div class="group-title">Phase 1: Setting up clear expectations (feedup)</div>
    <div id="G1">
        <div class="question">Q1. I formulate and share learning goals, trajectories and/or expectations for citizenship education.</div>
            <div class="likert">
                I never do this <input type="radio" name="G1Q1" value="1" />
                <input type="radio" name="G1Q1" value="2" />
                <input type="radio" name="G1Q1" value="3" />
                <input type="radio" name="G1Q1" value="4" />
                <input type="radio" name="G1Q1" value="5" /> I always do this
            </div>
        
        <div class="question">Q2. I formulate and share criteria for success on tasks related to citizenship education.</div>
            <div class="likert">
                I never do this <input type="radio" name="G1Q2" value="1" />
                <input type="radio" name="G1Q2" value="2" />
                <input type="radio" name="G1Q2" value="3" />
                <input type="radio" name="G1Q2" value="4" />
                <input type="radio" name="G1Q2" value="5" /> I always do this
            </div>
        
        <div class="question">Q3. I discuss learning goals and learning trajectories with students. Suggestions of students are hereby taken into account.</div>
            <div class="likert">
                I never do this <input type="radio" name="G1Q3" value="1" />
                <input type="radio" name="G1Q3" value="2" />
                <input type="radio" name="G1Q3" value="3" />
                <input type="radio" name="G1Q3" value="4" />
                <input type="radio" name="G1Q3" value="5" /> I always do this
            </div>
    
        <div class="question">Q4. How capable do you hold yourself in phase 1 in general?</div>
            <div class="likert">
                I never do this <input type="radio" name="G1Q4" value="1" />
                <input type="radio" name="G1Q4" value="2" />
                <input type="radio" name="G1Q4" value="3" />
                <input type="radio" name="G1Q4" value="4" />
                <input type="radio" name="G1Q4" value="5" /> I always do this
            </div>
    </div>


  <div class="group-title">Phase 2: How to observe, collect data, measure…</div>
    <div id="G2">
        <div class="question">Question 1</div>
            <div class="likert">
                I never do this <input type="radio" name="G2Q1" value="1" />
                <input type="radio" name="G2Q1" value="2" />
                <input type="radio" name="G2Q1" value="3" />
                <input type="radio" name="G2Q1" value="4" />
                <input type="radio" name="G2Q1" value="5" /> I always do this
            </div>
        
        <div class="question">Question 2</div>
            <div class="likert">
                I never do this <input type="radio" name="G2Q2" value="1" />
                <input type="radio" name="G2Q2" value="2" />
                <input type="radio" name="G2Q2" value="3" />
                <input type="radio" name="G2Q2" value="4" />
                <input type="radio" name="G2Q2" value="5" /> I always do this
            </div>
        
        <div class="question">Question 3</div>
            <div class="likert">
                I never do this <input type="radio" name="G2Q3" value="1" />
                <input type="radio" name="G2Q3" value="2" />
                <input type="radio" name="G2Q3" value="3" />
                <input type="radio" name="G2Q3" value="4" />
                <input type="radio" name="G2Q3" value="5" /> I always do this
            </div>
    
        <div class="question">Question 4</div>
            <div class="likert">
                I never do this <input type="radio" name="G2Q4" value="1" />
                <input type="radio" name="G2Q4" value="2" />
                <input type="radio" name="G2Q4" value="3" />
                <input type="radio" name="G2Q4" value="4" />
                <input type="radio" name="G2Q4" value="5" /> I always do this
            </div>
    </div>

  <div class="group-title">Phase 3: Analyzing observations, data…</div>
  <div id="G3">
        <div class="question">Question 1</div>
            <div class="likert">
                I never do this <input type="radio" name="G3Q1" value="1" />
                <input type="radio" name="G3Q1" value="2" />
                <input type="radio" name="G3Q1" value="3" />
                <input type="radio" name="G3Q1" value="4" />
                <input type="radio" name="G3Q1" value="5" /> I always do this
            </div>
        
            <div class="question">Question 2</div>
            <div class="likert">
                I never do this <input type="radio" name="G3Q2" value="1" />
                <input type="radio" name="G3Q2" value="2" />
                <input type="radio" name="G3Q2" value="3" />
                <input type="radio" name="G3Q2" value="4" />
                <input type="radio" name="G3Q2" value="5" /> I always do this
            </div>
        
            <div class="question">Question 3</div>
            <div class="likert">
                I never do this <input type="radio" name="G3Q3" value="1" />
                <input type="radio" name="G3Q3" value="2" />
                <input type="radio" name="G3Q3" value="3" />
                <input type="radio" name="G3Q3" value="4" />
                <input type="radio" name="G3Q3" value="5" /> I always do this
            </div>
    
            <div class="question">Question 4</div>
            <div class="likert">
                I never do this <input type="radio" name="G3Q4" value="1" />
                <input type="radio" name="G3Q4" value="2" />
                <input type="radio" name="G3Q4" value="3" />
                <input type="radio" name="G3Q4" value="4" />
                <input type="radio" name="G3Q4" value="5" /> I always do this
            </div>
  </div>


  <div class="group-title">Phase 4: Communicating about learning trajectories (feedback)</div>
    <div id="G4">
        <div class="question">Question 1</div>
            <div class="likert">
                I never do this <input type="radio" name="G4Q1" value="1" />
                <input type="radio" name="G4Q1" value="2" />
                <input type="radio" name="G4Q1" value="3" />
                <input type="radio" name="G4Q1" value="4" />
                <input type="radio" name="G4Q1" value="5" /> I always do this
            </div>
        
        <div class="question">Question 2</div>
            <div class="likert">
                I never do this <input type="radio" name="G4Q2" value="1" />
                <input type="radio" name="G4Q2" value="2" />
                <input type="radio" name="G4Q2" value="3" />
                <input type="radio" name="G4Q2" value="4" />
                <input type="radio" name="G4Q2" value="5" /> I always do this
            </div>
        
        <div class="question">Question 3</div>
            <div class="likert">
                I never do this <input type="radio" name="G4Q3" value="1" />
                <input type="radio" name="G4Q3" value="2" />
                <input type="radio" name="G4Q3" value="3" />
                <input type="radio" name="G4Q3" value="4" />
                <input type="radio" name="G4Q3" value="5" /> I always do this
            </div>
    
        <div class="question">Question 4</div>
            <div class="likert">
                I never do this <input type="radio" name="G4Q4" value="1" />
                <input type="radio" name="G4Q4" value="2" />
                <input type="radio" name="G4Q4" value="3" />
                <input type="radio" name="G4Q4" value="4" />
                <input type="radio" name="G4Q4" value="5" /> I always do this
            </div>
    </div>

  <div class="group-title">Phase 5: Acting consequently, adapting learning (feedforward)</div>
    <div id="G5">
        <div class="question">Question 1</div>
            <div class="likert">
                I never do this <input type="radio" name="G5Q1" value="1" />
                <input type="radio" name="G5Q1" value="2" />
                <input type="radio" name="G5Q1" value="3" />
                <input type="radio" name="G5Q1" value="4" />
                <input type="radio" name="G5Q1" value="5" /> I always do this
            </div>
        
        <div class="question">Question 2</div>
            <div class="likert">
                I never do this <input type="radio" name="G5Q2" value="1" />
                <input type="radio" name="G5Q2" value="2" />
                <input type="radio" name="G5Q2" value="3" />
                <input type="radio" name="G5Q2" value="4" />
                <input type="radio" name="G5Q2" value="5" /> I always do this
            </div>
        
        <div class="question">Question 3</div>
            <div class="likert">
                I never do this <input type="radio" name="G5Q3" value="1" />
                <input type="radio" name="G5Q3" value="2" />
                <input type="radio" name="G5Q3" value="3" />
                <input type="radio" name="G5Q3" value="4" />
                <input type="radio" name="G5Q3" value="5" /> I always do this
            </div>
    
        <div class="question">Question 4</div>
            <div class="likert">
                I never do this <input type="radio" name="G5Q4" value="1" />
                <input type="radio" name="G5Q4" value="2" />
                <input type="radio" name="G5Q4" value="3" />
                <input type="radio" name="G5Q4" value="4" />
                <input type="radio" name="G5Q4" value="5" /> I always do this
            </div>
    </div>

    <button class="button" onclick="calculateScore()">Submit</button>


    <!-- ??Fails to show up in the pdf - unless I move it into the chartContainer div (breaks css) - why?    ?? -->
    <div class="container-results">

        <div class="progress-bar">
            <div class="progress"></div>
        </div>

            <div id="feedbackG1">
                <span id="scoreG1"></span></br>
                <span id="feedbackG1Msg"></span>
            </div>

            <div id="feedbackG2">
                <span id="scoreG2"></span></br>
                <span id="feedbackG2Msg"></span>
            </div>

            <div id="feedbackG3">
                <span id="scoreG3"></span></br>
                <span id="feedbackG3Msg"></span>
            </div>

            <div id="feedbackG4">
                <span id="scoreG4"></span></br>
                <span id="feedbackG4Msg"></span>
            </div>

            <div id="feedbackG5">
                <span id="scoreG5"></span></br>
                <span id="feedbackG5Msg"></span>
            </div>

    </div>        

</div>


<!-- Spiderweb diagram goes here --> 
<div id="chartContainer"></div>


<!-- My .js file managing this html --> 
<script src="sat.js"></script>


    <!-- Download PDF button --> 
    <button id="download">Download PDF now!</button>


<!-- Load all required PDF libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<script src="https://unpkg.com/pdf-lib"></script>


<script>
    // Event listener for when the download button is clicked
    document.getElementById('download').addEventListener('click', async function () {
        const { jsPDF } = window;
        const { PDFDocument } = PDFLib;

        // Configuration options for html2pdf
        const opt = {
            margin: 1,
            filename: 'myfile.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };
        
        // Set the options and source element for html2pdf and create a worker
        const worker = html2pdf().set(opt).from(document.getElementById('quizContainer')).outputPdf('arraybuffer');
        
        // Once the worker has completed its task
        worker.then(async function (pdfAsString) {

            // Load the original PDF document
            const textPdfBytes = new Uint8Array(pdfAsString);
            const textPdfDoc = await PDFDocument.load(textPdfBytes);
            
            // Create a new PDF document
            const finalPdfDoc = await PDFDocument.create();
            
            // Generate a canvas from the chartContainer element   
            const chartCanvas = await html2canvas(document.getElementById('chartContainer'));
            
            // Convert the canvas to a data URL
            const imgData = chartCanvas.toDataURL('image/png');
            
            // Create a new jsPDF document and add the image to it
            const chartPdf = new jsPDF();
            chartPdf.addImage(imgData, 'PNG', 0, 0, chartPdf.internal.pageSize.getWidth(), chartCanvas.height * chartPdf.internal.pageSize.getWidth() / chartCanvas.width);
            
            // Load the chart PDF document
            const chartPdfBytes = new Uint8Array(chartPdf.output("arraybuffer"));
            const chartPdfDoc = await PDFDocument.load(chartPdfBytes);

            // Add the pages from the original and chart PDFs to the new PDF
            const [textPdfPage] = await finalPdfDoc.copyPages(textPdfDoc, textPdfDoc.getPageIndices());
            finalPdfDoc.addPage(textPdfPage);
            const [chartPdfPage] = await finalPdfDoc.copyPages(chartPdfDoc, chartPdfDoc.getPageIndices());
            finalPdfDoc.addPage(chartPdfPage);
            
            // Save the final PDF and trigger a download
            const mergedPdfBytes = await finalPdfDoc.save();
            download(mergedPdfBytes, "mergedPdf.pdf", "application/pdf");
        });
    });
    
    // Function to trigger a download of a Blob
    function download(data, filename, type) {
        
        // Create a new Blob from the data
        const file = new Blob([data], { type: type });
        
        // If IE10+, use msSaveOrOpenBlob
        if (window.navigator.msSaveOrOpenBlob)
            window.navigator.msSaveOrOpenBlob(file, filename);
        else {
            
            // For other browsers, create a download link and simulate a click
            const a = document.createElement("a"),
                url = URL.createObjectURL(file);
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            
            // Remove the link after the download is initiated
            setTimeout(function () {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 0);
        }
    }
    </script>


</body>

</html>